<section class="section section--muted section--no-bottom">
  <h2 class="section__title">{{ "PAGES.Settings.TFA.IntroSection.Title" | translate }}</h2>

  <div class="section__content pt-2" [innerHTML]="'PAGES.Settings.TFA.IntroSection.Content' | translate"></div>
</section>

<section class="section tfa" [ngClass]="{'section--no-bottom': tfaInfo.enabled || loading}">
  <h2 class="section__title">
    <span>{{ "PAGES.Settings.TFA.SecretKeySection.Title" | translate }}</span>
    <div class="section__title-widget">

      <div class="tfa__status tfa__status--enabled" *ngIf="tfaInfo.enabled; else tfaDisabled" (click)="codeForm.form.valid && enableTFA()">
        {{ "PAGES.Settings.TFA.SecretKeySection.TitleWidget.Enabled" | translate }}
      </div>

      <ng-template #tfaDisabled>
        <div class="tfa__status tfa__status--disabled" (click)="codeForm.form.valid && enableTFA()">
          {{ "PAGES.Settings.TFA.SecretKeySection.TitleWidget.Disabled" | translate }}
        </div>
      </ng-template>

    </div>
  </h2>

  <div class="section__content pt-2">
    <div class="progress-linear progress-linear--tiny" *ngIf="loading">
      <div class="container"></div>
    </div>

    <form name="codeForm" #codeForm="ngForm" (ngSubmit)="codeForm.form.valid && enableTFA()" novalidate>
      <div class="form-group">
        <label for="inputCode">{{ "PAGES.Settings.TFA.SecretKeySection.CodeLabel" | translate }}</label>
        <div class="form-help text-muted">Input your 6-digit authentication code</div>
        <input type="text" noAutoComplete id="inputCode" required pattern="[0-9]{6,6}"
               name="code" [(ngModel)]="tfaModel.code" #code="ngModel"
               class="form-control col-2 mt-4"
               [ngClass]="{'is-invalid': (errors?.Code || !code.valid) && (codeForm.submitted || !code.pristine)}"
               (ngModelChange)="errors.Code = false"
               [readonly]="processing">

        <div class="invalid-feedback" *ngIf="code.errors">
          {{ "PAGES.Settings.TFA.SecretKeySection.Errors.pattern" | translate }}
        </div>
        <div class="invalid-feedback" *ngIf="errors?.Code">
          {{ errors?.Code }}
        </div>
      </div>

      <div class="form-group mt-4">
        <button type="submit" class="btn btn-primary mt-2" [blur]="buttonBlur" [disabled]="processing">
          {{ (tfaInfo.enabled ? "PAGES.Settings.TFA.SecretKeySection.Buttons.Disable" : "PAGES.Settings.TFA.SecretKeySection.Buttons.Enable") | translate }}
          <img *ngIf="processing" alt="Processing..." width="17" height="17" class="form-loader" src="assets/img/loader-black-bg-gold.gif">
        </button>
      </div>
    </form>

    <!--<ng-container *ngIf="tfaInfo.qrData && tfaInfo.secret">-->
    <!--<div [innerHTML]="'PAGES.Settings.TFA.SecretKeySection.Text' | translate"></div>-->

    <!--<div class="text-center">-->
    <!--<svg class="tfa__icon" width="52px" height="52px">-->
    <!--<use xlink:href="#tfa-secret"></use>-->
    <!--</svg>-->

    <!--<div class="tfa__key-label">{{ "PAGES.Settings.TFA.SecretKeySection.KeyLabel" | translate }}</div>-->
    <!--<div class="tfa__key">{{ tfaInfo.secret }}</div>-->

    <!--<ngx-qrcode-->
    <!--[qrc-value]="tfaInfo.qrData"-->
    <!--qrc-class="tfa__qrcode"-->
    <!--qrc-errorCorrectionLevel="L"></ngx-qrcode>-->


    <!--</div>-->
    <!--</ng-container>-->
  </div>
</section>
