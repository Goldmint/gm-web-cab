<section class="section section--no-bottom" *ngIf="loading; else blockLoaded">
  <h2 class="section__title">{{ "COMMONS.Loading" | translate }}</h2>
  <div class="section__content pt-4">
    <div class="progress-linear progress-linear--tiny">
      <div class="container"></div>
    </div>
  </div>
</section>
<ng-template #blockLoaded>

  <!--DISABLED-->
  <ng-container *ngIf="!tfaInfo.enabled; else blockEnabled">

    <!--TEXT-->
    <section class="section tfa section--warning section--no-bottom">

      <h2 class="section__title">
        <span>{{ "PAGES.Settings.TFA.SecretKeySection.Title" | translate }}</span>
        <div class="section__title-widget">
          <div class="tfa__status tfa__status--disabled">
            {{ "PAGES.Settings.TFA.SecretKeySection.TitleWidget.Disabled" | translate }}
          </div>
        </div>
      </h2>

      <div class="section__content pt-2" [innerHTML]="'PAGES.Settings.TFA.SecretKeySection.WarningText' | translate"></div>
    </section>

    <!--STEP 1-->
    <section class="section tfa section--no-bottom">

      <h2 class="section__title">
        <span>{{ "PAGES.Settings.TFA.SecretKeySection.Steps.One" | translate }}</span>
      </h2>

      <div class="section__content pt-2">
        <div [innerHTML]="'PAGES.Settings.TFA.SecretKeySection.Text' | translate"></div>
        <div class="tfa__key">{{ tfaInfo.secret }}</div>
      </div>
    </section>

    <!--STEP 2-->
    <section class="section tfa section--no-bottom">

      <h2 class="section__title">
        <span>{{ "PAGES.Settings.TFA.SecretKeySection.Steps.Two" | translate }}</span>
      </h2>

      <div class="section__content pt-2">
        <a href="https://itunes.apple.com/dm/app/google-authenticator/id388497605" target="_blank" title="App Store"><img src="assets/img/fo_app-store.png" alt="App Store"></a>
        <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" target="_blank" title="Google Play" class="ml-4"><img src="assets/img/fo_google-play.png" alt="Google Play"></a>
      </div>
    </section>

    <!--STEP 3-->
    <section class="section tfa section--no-bottom">

      <h2 class="section__title">
        <span>{{ "PAGES.Settings.TFA.SecretKeySection.Steps.Three" | translate }}</span>
      </h2>

      <div class="section__content pt-2">
        <ngx-qrcode [qrc-value]="tfaInfo.qrData"
                    qrc-class="tfa__qrcode"
                    qrc-errorCorrectionLevel="L">

        </ngx-qrcode>
      </div>
    </section>

    <!--STEP 4-->
    <section class="section tfa">

      <h2 class="section__title">
        <span>{{ "PAGES.Settings.TFA.SecretKeySection.Steps.Four" | translate }}</span>
      </h2>

      <div class="section__content">
        <form name="codeForm" (ngSubmit)="codeForm.form.valid && toggleTfa()" #codeForm="ngForm" novalidate>
          <div class="form-group">

            <label for="inputCode">{{ "PAGES.Settings.TFA.SecretKeySection.CodeLabel" | translate }}</label>
            <input type="text" noAutoComplete id="inputCode" name="code" class="form-control" required
                   maxlength="6" pattern="[0-9]{6,6}"
                   [(ngModel)]="tfaModel.code" #code="ngModel"
                   [ngClass]="{'is-invalid': (errors?.Code || !code.valid) && (codeForm.submitted || !code.pristine)}"
                   (ngModelChange)="errors.Code = false"
                   [readonly]="processing">

            <div class="invalid-feedback" *ngIf="code.errors">
              {{ "PAGES.Settings.TFA.SecretKeySection.Errors.pattern" | translate }}
            </div>
            <div class="invalid-feedback" *ngIf="errors?.Code">
              {{ errors?.Code }}
            </div>
          </div>

          <div class="form-group mt-4">
            <button type="submit" class="btn btn-primary mt-2" [blur]="buttonBlur" [disabled]="processing">
              {{ "PAGES.Settings.TFA.SecretKeySection.Buttons.Enable" | translate }}
              <img *ngIf="processing" alt="Processing..." width="17" height="17" class="form-loader" src="assets/img/loader-black-bg-gold.gif">
            </button>
          </div>
        </form>
      </div>
    </section>


  </ng-container>

  <!--ENABLED-->
  <ng-template #blockEnabled>

    <section class="section tfa">

      <h2 class="section__title">
        <span>{{ "PAGES.Settings.TFA.SecretKeySection.Title" | translate }}</span>
        <div class="section__title-widget">
          <div class="tfa__status tfa__status--enabled">
            {{ "PAGES.Settings.TFA.SecretKeySection.TitleWidget.Enabled" | translate }}
          </div>
        </div>
      </h2>

      <div class="section__content">

        <form name="codeForm" (ngSubmit)="codeForm.form.valid && toggleTfa()" #codeForm="ngForm" novalidate>
          <div class="form-group">

            <label for="inputCodeTwo">{{ "PAGES.Settings.TFA.SecretKeySection.CodeLabel" | translate }}</label>
			
			<div class="invalid-feedback">{{ "PAGES.Settings.TFA.SecretKeySection.DisableWarning" | translate }}</div>
			
            <input type="text" noAutoComplete id="inputCodeTwo" name="code" class="form-control" required
                   maxlength="6" pattern="[0-9]{6,6}"
                   [(ngModel)]="tfaModel.code" #code="ngModel"
                   [ngClass]="{'is-invalid': (errors?.Code || !code.valid) && (codeForm.submitted || !code.pristine)}"
                   (ngModelChange)="errors.Code = false"
                   [readonly]="processing">

            <div class="invalid-feedback" *ngIf="code.errors">
              {{ "PAGES.Settings.TFA.SecretKeySection.Errors.pattern" | translate }}
            </div>
            <div class="invalid-feedback" *ngIf="errors?.Code">
              {{ errors?.Code }}
            </div>
          </div>

          <div class="form-group mt-4">
            <button type="submit" class="btn btn-primary mt-2" [blur]="buttonBlur" [disabled]="processing">
              {{ "PAGES.Settings.TFA.SecretKeySection.Buttons.Disable" | translate }}
              <img *ngIf="processing" alt="Processing..." width="17" height="17" class="form-loader" src="assets/img/loader-black-bg-gold.gif">
            </button>
          </div>
        </form>
      </div>
    </section>
  </ng-template>
</ng-template>
